SELECT ob.nombrebodega AS Bodega, of.nombrefabricante AS Propietario, vm.nombremarca AS Marca, il.descripcionlote AS Zafra, ip.nombreproducto AS Producto, tm.nombremovimiento AS Movimiento, ik.fecha AS Fecha, CASE WHEN ik.idtipomovimiento = 16 THEN concat("<Center><A href=../../modulos/envios/envio_imprimir.php?idenvio=",ik.foliodoctoorigen,">",ik.foliodoctoorigen,"</A></Center>") WHEN ik.idtipomovimiento = 17 THEN concat("<Center><A href=../../modulos/recepciones/recepcion_imprimir.php?idrecepcion=",ik.foliodoctoorigen,">",ik.foliodoctoorigen,"</A></Center>") WHEN ik.idtipomovimiento = 18 THEN concat("<Center><A href=../../modulos/retiros/retiro_imprimir.php?folio=",ik.foliodoctoorigen,">",ik.foliodoctoorigen,"</A></Center>") ELSE 'N/A' END "FolioDocOrigen", um.descripcionunidad AS Presentacion, F OR MAT(ik.cantidadinicial * um.factor, 2) AS SaldoInicialTM, F OR MAT(ik.cantidadinicial, 2) AS SaldoInicial, CASE WHEN tm.efectoinventario = 1 THEN F OR MAT(ik.cantidadmovimiento * um.factor, 2) ELSE F OR MAT(0, 2) END AS EntradasTM, CASE WHEN tm.efectoinventario = 1 THEN F OR MAT(ik.cantidadmovimiento, 2) ELSE F OR MAT(0, 2) END AS Entradas, CASE WHEN tm.efectoinventario = -1 THEN F OR MAT(ik.cantidadmovimiento * um.factor, 2) ELSE F OR MAT(0, 2) END AS SalidasTM, CASE WHEN tm.efectoinventario = -1 THEN F OR MAT(ik.cantidadmovimiento, 2) ELSE F OR MAT(0, 2) END AS Salidas, F OR MAT(ik.saldo * um.factor, 2) AS SaldoTM, F OR MAT(ik.saldo, 2) AS Saldo FROM inventarios_kardex ik inner join operaciones_fabricantes of on of.idfabricante=ik.idfabricante left join vista_marcas vm on vm.idmarca=ik.idmarca inner join operaciones_bodegas ob on ob.idbodega=ik.idbodega inner join inventarios_productos ip on ip.idproducto=ik.idproducto inner join inventarios_estados ie on ie.idestadoproducto=ik.idestadoproducto inner join inventarios_lotes il on il.idloteproducto=ik.idloteproducto left join inventarios_unidadesmedida um on um.idunidadmedida= ip.idunidadmedida inner join inventarios_tiposmovimiento tm on tm.idtipomovimiento=ik.idtipomovimiento WHERE (ik.idbodega in (select idbodega from relaciones_usuariosbodegas where idempleado=2) OR NOT EXISTS (SELECT 1 FROM relaciones_usuariosbodegas WHERE idempleado =2)) And ik.fecha between " 00:00:00" And "[#Al] 23:59:59" and of.nombrefabricante like "%Atencingo%" and vm.nombremarca LIKE '%%' and ip.nombreproducto LIKE '%%' and il.descripcionlote LIKE '%%' and ie.descripcionestado LIKE '%%' and ob.nombrebodega LIKE '%%' OR DER BY ik.id
